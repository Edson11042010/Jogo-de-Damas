<!DOCTYPE html>
<html lang="pt-BR">
<head>

  <!-- CabeÃ§alho do cÃ³digo: define metadados, tÃ­tulo e CSS -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Damas</title>
  <!-- Link para o arquivo CSS externo -->
  <link rel="stylesheet" href="DAMAS EPA 2025.css">

</head>
<body>

<!-- Corpo do cÃ³digo: elementos visÃ­veis no site -->
<div class="topo">Jogo de Damas</div> <!-- CabeÃ§alho do jogo -->

<!-- BotÃ£o para reiniciar o jogo -->
<button onclick="reiniciar()"> Reiniciar</button>

<!-- Placar do jogo -->
<div class="placar">
   Vermelho: <span id="pontosRed">0</span> | Preto: <span id="pontosBlack">0</span>
</div>

<!-- IndicaÃ§Ã£o do turno -->
<div id="turno">Vez de: Vermelho ðŸ”´</div>

<!-- Tabuleiro do jogo -->
<div class="board" id="board"></div>

<!-- Script JavaScript para funcionamento do jogo -->
<script>
/* Tamanho do tabuleiro */
const SIZE = 8;

/* Estado do tabuleiro */
let board = [];
let selected = null;
let currentPlayer = "red";
let pontos = { red:0, black:0 };

/* ReferÃªncia ao elemento HTML do tabuleiro */
const boardEl = document.getElementById("board");

/* FunÃ§Ã£o que cria o tabuleiro inicial */
function createBoard() {
  boardEl.innerHTML = "";
  board = [];
  pontos = { red:0, black:0 };
  selected = null;
  currentPlayer = "red";
  updatePlacar();

  for(let r=0; r<SIZE; r++){
    let row = [];
    for(let c=0; c<SIZE; c++){
      const cell = document.createElement("div");
      cell.className = "cell " + ((r+c)%2===0 ? "light":"dark");
      cell.dataset.row = r;
      cell.dataset.col = c;
      cell.addEventListener("click",()=>handleClick(r,c));

      if((r+c)%2===1){
        if(r<3){
          cell.appendChild(createPiece("black"));
          row.push("black");
        } else if(r>4){
          cell.appendChild(createPiece("red"));
          row.push("red");
        } else row.push(null);
      } else row.push(null);

      boardEl.appendChild(cell);
    }
    board.push(row);
  }
}

/* FunÃ§Ã£o que cria uma peÃ§a */
function createPiece(color){
  const piece = document.createElement("div");
  piece.className = "piece " + color;
  if(color.includes("king")) piece.classList.add("king");
  return piece;
}

/* Clique do jogador */
function handleClick(r,c){
  const cellValue = board[r][c];
  if(cellValue && cellValue.startsWith(currentPlayer)){
    clearSelection();
    selected = {r,c};
    getCell(r,c).classList.add("selected");
  } 
  else if(!cellValue && selected){
    movePiece(selected.r, selected.c, r, c);
  }
}

/* MovimentaÃ§Ã£o da peÃ§a */
function movePiece(r1,c1,r2,c2){
  let piece = board[r1][c1];
  if(!isValidMove(r1,c1,r2,c2,piece)) return;

  // captura
  if(Math.abs(r2-r1)===2 && Math.abs(c2-c1)===2){
    const midRow = (r1+r2)/2;
    const midCol = (c1+c2)/2;
    board[midRow][midCol] = null;
    pontos[currentPlayer]++;
    updatePlacar();
  }

  // move
  board[r1][c1] = null;
  board[r2][c2] = piece;

  // promoÃ§Ã£o
  if(piece==="red" && r2===0) board[r2][c2]="red-king";
  if(piece==="black" && r2===SIZE-1) board[r2][c2]="black-king";

  redrawBoard();

  // captura mÃºltipla
  if(Math.abs(r2-r1)===2){
    selected = {r:r2, c:c2};
    getCell(r2,c2).classList.add("selected");
    if(temCaptura(r2,c2, board[r2][c2])) return;
  }

  selected = null;
  currentPlayer = currentPlayer==="red" ? "black" : "red";
  updatePlacar();
}

/* ValidaÃ§Ã£o de movimento */
function isValidMove(r1,c1,r2,c2,piece){
  if(board[r2][c2]) return false;
  const isKing = piece.includes("king");
  const dir = piece.startsWith("red")?-1:1;

  // peÃ§a normal
  if(!isKing){
    if(Math.abs(c1-c2)===1 && r2-r1===dir) return true;
    if(Math.abs(c1-c2)===2 && r2-r1===dir*2){
      const midRow = (r1+r2)/2;
      const midCol = (c1+c2)/2;
      if(board[midRow][midCol] && !board[midRow][midCol].startsWith(piece.split("-")[0])) return true;
    }
    return false;
  }

  // dama: pode andar qualquer nÃºmero de casas na diagonal
  if(isKing){
    if(Math.abs(r2-r1) === Math.abs(c2-c1)){
      let stepR = (r2 > r1 ? 1 : -1);
      let stepC = (c2 > c1 ? 1 : -1);
      let r = r1 + stepR, c = c1 + stepC;
      let enemyFound = false;

      while(r !== r2 && c !== c2){
        if(board[r][c]){
          if(board[r][c].startsWith(piece.split("-")[0])){
            return false;
          } else {
            if(enemyFound) return false;
            enemyFound = true;
          }
        }
        r += stepR;
        c += stepC;
      }
      return true;
    }
  }
  return false;
}

/* Verifica se hÃ¡ captura possÃ­vel */
function temCaptura(r,c,piece){
  const isKing = piece.includes("king");
  const dirs = isKing ? [[1,1],[1,-1],[-1,1],[-1,-1]] : 
               (piece.startsWith("red")?[[-1,1],[-1,-1]]:[[1,1],[1,-1]]);
  for(const [dr,dc] of dirs){
    const midR = r+dr;
    const midC = c+dc;
    const endR = r+dr*2;
    const endC = c+dc*2;
    if(endR>=0 && endR<SIZE && endC>=0 && endC<SIZE){
      if(board[midR][midC] && !board[midR][midC].startsWith(piece.split("-")[0]) && !board[endR][endC]){
        return true;
      }
    }
  }
  return false;
}

/* Pega cÃ©lula pelo Ã­ndice */
function getCell(r,c){ return boardEl.children[r*SIZE+c]; }

/* Atualiza visual do tabuleiro */
function redrawBoard(){
  for(let r=0;r<SIZE;r++){
    for(let c=0;c<SIZE;c++){
      const cell = getCell(r,c);
      cell.innerHTML="";
      cell.classList.remove("selected");
      if(board[r][c]) cell.appendChild(createPiece(board[r][c]));
    }
  }
}

/* Limpa seleÃ§Ã£o */
function clearSelection(){
  for(let i=0;i<boardEl.children.length;i++) boardEl.children[i].classList.remove("selected");
}

/* Reinicia o jogo */
function reiniciar(){ createBoard(); }

/* Atualiza placar e turno */
function updatePlacar(){
  document.getElementById("pontosRed").innerText = pontos.red;
  document.getElementById("pontosBlack").innerText = pontos.black;
  const turnoEl = document.getElementById("turno");
  turnoEl.innerText = currentPlayer === "red" ? "Vez de: Vermelho ðŸ”´" : "Vez de: Preto âš«";
}

/* Inicializa tabuleiro */
createBoard();
</script>
</body>
</html>

